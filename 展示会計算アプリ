<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†å‰²æ‰‹æ•°æ–™è¨ˆç®—ã‚¢ãƒ—ãƒª</title>
    <style>
        :root {
            --color-primary: #32b8c6;
            --color-primary-hover: #1d745f;
            --color-primary-active: #1a7273;
            --color-bg: #fcfcf9;
            --color-surface: #ffffff;
            --color-text: #134252;
            --color-text-secondary: #626c71;
            --color-border: rgba(94, 82, 64, 0.2);
            --color-success: #208d8d;
            --color-error: #c0152f;
            --color-warning: #a84b2f;
            --color-focus: rgba(33, 128, 141, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            padding: 12px;
            line-height: 1.5;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 16px 0;
            border-bottom: 2px solid var(--color-border);
        }

        h1 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .subtitle {
            font-size: 12px;
            color: var(--color-text-secondary);
        }

        section {
            background: var(--color-surface);
            border-radius: 8px;
            border: 1px solid var(--color-border);
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
        }

        section h2 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--color-primary);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 8px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        label {
            display: block;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--color-text);
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background: var(--color-surface);
            color: var(--color-text);
            font-family: inherit;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px var(--color-focus);
        }

        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .product-item {
            background: #f5f5f5;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .product-item .form-group {
            margin-bottom: 8px;
        }

        .product-item input, .product-item select {
            padding: 8px;
            font-size: 13px;
        }

        .btn-remove {
            background: #f5f5f5;
            border: 1px solid var(--color-error);
            color: var(--color-error);
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            width: 100%;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-remove:hover {
            background: rgba(192, 21, 47, 0.1);
        }

        button.btn-add {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            width: 100%;
            font-weight: 500;
            transition: all 0.2s;
            margin-top: 8px;
        }

        button.btn-add:hover {
            background: var(--color-primary-hover);
        }

        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .result-box {
            background: #f9f9f9;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        .result-label {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .result-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .result-sub {
            font-size: 10px;
            color: var(--color-text-secondary);
            margin-top: 4px;
        }

        .calculation-summary {
            background: linear-gradient(135deg, rgba(50, 184, 198, 0.05), rgba(50, 184, 198, 0.02));
            border-left: 4px solid var(--color-primary);
            padding: 12px;
            border-radius: 4px;
            margin-top: 12px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px dotted var(--color-border);
        }

        .summary-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .summary-label {
            color: var(--color-text-secondary);
        }

        .summary-value {
            font-weight: 600;
            color: var(--color-text);
        }

        .final-total {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 2px solid var(--color-primary);
            font-size: 14px;
            font-weight: 700;
            color: var(--color-primary);
            display: flex;
            justify-content: space-between;
        }

        .btn-calculate {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-bottom: 12px;
            transition: all 0.2s;
        }

        .btn-calculate:hover {
            background: var(--color-primary-hover);
        }

        .btn-calculate:active {
            background: var(--color-primary-active);
        }

        .history-item {
            background: #f9f9f9;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-item:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .history-time {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-bottom: 4px;
        }

        .history-customer {
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .history-total {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-primary);
        }

        .history-detail {
            font-size: 11px;
            color: var(--color-text-secondary);
            margin-top: 4px;
        }

        .btn-delete {
            background: rgba(192, 21, 47, 0.1);
            color: var(--color-error);
            border: 1px solid var(--color-error);
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 10px;
            cursor: pointer;
            margin-top: 8px;
            font-weight: 500;
            width: 100%;
        }

        .btn-delete:hover {
            background: rgba(192, 21, 47, 0.2);
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            border-bottom: 2px solid var(--color-border);
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 10px 16px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            color: var(--color-text-secondary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            margin-bottom: -2px;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: flex-end;
        }

        .modal-content {
            background: var(--color-surface);
            width: 100%;
            max-height: 90vh;
            border-radius: 12px 12px 0 0;
            padding: 20px;
            overflow-y: auto;
        }

        .modal-close {
            background: var(--color-border);
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            width: 100%;
            margin-top: 12px;
        }

        .detail-section {
            background: #f5f5f5;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .detail-section h3 {
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--color-primary);
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            margin-bottom: 6px;
            padding-bottom: 6px;
            border-bottom: 1px dotted var(--color-border);
        }

        .detail-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .empty-state {
            text-align: center;
            padding: 24px 12px;
            color: var(--color-text-secondary);
        }

        .empty-state-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .empty-state-text {
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>åˆ†å‰²æ‰‹æ•°æ–™è¨ˆç®—ã‚¢ãƒ—ãƒª</h1>
            <p class="subtitle">å•†å“è¨ˆç®— Ã— æ”¯æ‰•ã„æ‰‹æ•°æ–™</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('calculator')">è¨ˆç®—</button>
            <button class="tab-btn" onclick="switchTab('history')">å±¥æ­´</button>
            <button class="tab-btn" onclick="switchTab('preset')">ãƒªã‚¹ãƒˆç®¡ç†</button>
        </div>

        <!-- è¨ˆç®—ã‚¿ãƒ– -->
        <div id="calculator" class="tab-content active">
            <section>
                <h2>åŸºæœ¬æƒ…å ±</h2>
                <div class="form-group">
                    <label>é¡§å®¢ç¨®åˆ¥</label>
                    <select id="customerType" onchange="updateCalculation()">
                        <option value="student">ä¿®ç§‘ç”Ÿ</option>
                        <option value="member">ã—ã‚…ã†ç¾ä¼šç”Ÿ</option>
                        <option value="instructor">è¬›å¸«</option>
                    </select>
                </div>
            </section>

            <section>
                <h2>å•†å“æƒ…å ±</h2>
                <div id="productsList"></div>
                <button class="btn-add" onclick="addProduct()">+ å•†å“ã‚’è¿½åŠ </button>
            </section>

            <section>
                <h2>æ”¯æ‰•ã„æ–¹æ³•ï¼ˆã‚¸ãƒ£ãƒƒã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ï¼‰</h2>
                <div class="form-group">
                    <label>æ”¯æ‰•ã„å›æ•°</label>
                    <select id="jackxPayments" onchange="updateCalculation()">
                        <option value="1">1å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="3">3å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="6">6å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="10">10å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="12">12å›ï¼ˆæ‰‹æ•°æ–™: 1.2%ï¼‰</option>
                        <option value="15">15å›ï¼ˆæ‰‹æ•°æ–™: 3.0%ï¼‰</option>
                        <option value="18">18å›ï¼ˆæ‰‹æ•°æ–™: 4.8%ï¼‰</option>
                        <option value="20">20å›ï¼ˆæ‰‹æ•°æ–™: 6.0%ï¼‰</option>
                        <option value="24">24å›ï¼ˆæ‰‹æ•°æ–™: 8.4%ï¼‰</option>
                        <option value="30">30å›ï¼ˆæ‰‹æ•°æ–™: 12.0%ï¼‰</option>
                        <option value="36">36å›ï¼ˆæ‰‹æ•°æ–™: 15.6%ï¼‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ã‚¹ã‚­ãƒƒãƒ—æœˆæ•°</label>
                    <select id="jackxSkip" onchange="updateCalculation()">
                        <option value="0">ã‚¹ã‚­ãƒƒãƒ—ãªã—</option>
                        <option value="1">1ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+0.5%ï¼‰</option>
                        <option value="2">2ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+1.0%ï¼‰</option>
                        <option value="3">3ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+1.5%ï¼‰</option>
                        <option value="4">4ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+2.0%ï¼‰</option>
                        <option value="5">5ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+2.5%ï¼‰</option>
                        <option value="6">6ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+3.0%ï¼‰</option>
                    </select>
                </div>
            </section>

            <section>
                <h2>æ”¯æ‰•ã„æ–¹æ³•ï¼ˆã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãƒ»KLï¼‰</h2>
                <div class="form-group">
                    <label>æ”¯æ‰•ã„å›æ•°</label>
                    <select id="klPayments" onchange="updateCalculation()">
                        <option value="1">1å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="3">3å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="6">6å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="10">10å›ï¼ˆæ‰‹æ•°æ–™: 0%ï¼‰</option>
                        <option value="12">12å›ï¼ˆæ‰‹æ•°æ–™: 1.0%ï¼‰</option>
                        <option value="15">15å›ï¼ˆæ‰‹æ•°æ–™: 2.1%ï¼‰</option>
                        <option value="18">18å›ï¼ˆæ‰‹æ•°æ–™: 3.1%ï¼‰</option>
                        <option value="20">20å›ï¼ˆæ‰‹æ•°æ–™: 3.8%ï¼‰</option>
                        <option value="24">24å›ï¼ˆæ‰‹æ•°æ–™: 5.2%ï¼‰</option>
                        <option value="30">30å›ï¼ˆæ‰‹æ•°æ–™: 7.3%ï¼‰</option>
                        <option value="36">36å›ï¼ˆæ‰‹æ•°æ–™: 9.4%ï¼‰</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ã‚¹ã‚­ãƒƒãƒ—æœˆæ•°</label>
                    <select id="klSkip" onchange="updateCalculation()">
                        <option value="0">ã‚¹ã‚­ãƒƒãƒ—ãªã—</option>
                        <option value="1">1ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+0.5%ï¼‰</option>
                        <option value="2">2ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+1.0%ï¼‰</option>
                        <option value="3">3ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+1.5%ï¼‰</option>
                        <option value="4">4ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+2.0%ï¼‰</option>
                        <option value="5">5ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+2.5%ï¼‰</option>
                        <option value="6">6ãƒ¶æœˆã‚¹ã‚­ãƒƒãƒ—ï¼ˆ+3.0%ï¼‰</option>
                    </select>
                </div>
            </section>

            <button class="btn-calculate" onclick="saveToHistory()">è¨ˆç®—çµæœã‚’ä¿å­˜</button>

            <section id="resultsSection" style="display: none;">
                <h2>è¨ˆç®—çµæœ</h2>
                <div class="calculation-summary" id="summaryDetails"></div>
            </section>
        </div>

        <!-- å±¥æ­´ã‚¿ãƒ– -->
        <div id="history" class="tab-content">
            <section id="historySection"></section>
        </div>

        <!-- ãƒªã‚¹ãƒˆç®¡ç†ã‚¿ãƒ– -->
        <div id="preset" class="tab-content">
            <section>
                <h2>ã‚¸ãƒ£ãƒƒã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰æ‰‹æ•°æ–™ç®¡ç†</h2>
                <div id="jackxFeeList"></div>
            </section>
            <section>
                <h2>ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãƒ»KLæ‰‹æ•°æ–™ç®¡ç†</h2>
                <div id="klFeeList"></div>
            </section>
            <section>
                <h2>ã‚¬ãƒ¼ãƒ‰ç®¡ç†</h2>
                <div id="guardList"></div>
                <button class="btn-add" onclick="addPresetItem('guard')">+ ã‚¬ãƒ¼ãƒ‰ã‚’è¿½åŠ </button>
            </section>
            <section>
                <h2>è£ç‰©ç®¡ç†</h2>
                <div id="liningList"></div>
                <button class="btn-add" onclick="addPresetItem('lining')">+ è£ç‰©ã‚’è¿½åŠ </button>
            </section>
            <section>
                <h2>ä»•ç«‹ç®¡ç†</h2>
                <div id="tailorList"></div>
                <button class="btn-add" onclick="addPresetItem('tailor')">+ ä»•ç«‹ã‚’è¿½åŠ </button>
            </section>
            <section>
                <h2>ãã®ä»–ç®¡ç†</h2>
                <div id="otherList"></div>
                <button class="btn-add" onclick="addPresetItem('other')">+ ãã®ä»–ã‚’è¿½åŠ </button>
            </section>
        </div>
    </div>

    <div class="modal" id="detailModal">
        <div class="modal-content" id="detailContent"></div>
    </div>

    <script>
        // æ‰‹æ•°æ–™ãƒ†ãƒ¼ãƒ–ãƒ«
        const feeStructure = {
            jackx: {
                payments: {
                    1: 0, 3: 0, 6: 0, 10: 0, 12: 1.2, 15: 3.0, 18: 4.8, 20: 6.0, 24: 8.4, 30: 12.0, 36: 15.6
                },
                skip: { 0: 0, 1: 0.5, 2: 1.0, 3: 1.5, 4: 2.0, 5: 2.5, 6: 3.0 }
            },
            kl: {
                payments: {
                    1: 0, 3: 0, 6: 0, 10: 0, 12: 1.0, 15: 2.1, 18: 3.1, 20: 3.8, 24: 5.2, 30: 7.3, 36: 9.4
                },
                skip: { 0: 0, 1: 0.5, 2: 1.0, 3: 1.5, 4: 2.0, 5: 2.5, 6: 3.0 }
            }
        };

        // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆLocalStorageã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
        let presetData = {
            guard: [
                { id: 1, name: 'ã‚¬ãƒ¼ãƒ‰ï¼ˆæ¨™æº–ï¼‰', price: 3000 },
                { id: 2, name: 'ã‚¬ãƒ¼ãƒ‰ï¼ˆåšæ‰‹ï¼‰', price: 4000 },
                { id: 3, name: 'ã‚¬ãƒ¼ãƒ‰ï¼ˆç‰¹æ®Šï¼‰', price: 5000 }
            ],
            lining: [
                { id: 4, name: 'è£ç‰©ï¼ˆæ¨™æº–ï¼‰', price: 2000 },
                { id: 5, name: 'è£ç‰©ï¼ˆä¸Šè³ªï¼‰', price: 3500 },
                { id: 6, name: 'è£ç‰©ï¼ˆç‰¹æ®Šï¼‰', price: 4500 }
            ],
            tailor: [
                { id: 7, name: 'ä»•ç«‹ï¼ˆæ¨™æº–ï¼‰', price: 15000 },
                { id: 8, name: 'ä»•ç«‹ï¼ˆé«˜ç´šï¼‰', price: 25000 },
                { id: 9, name: 'ä»•ç«‹ï¼ˆç‰¹æ®Šï¼‰', price: 35000 }
            ],
            other: [
                { id: 10, name: 'ãã®ä»–ï¼ˆÂ¥5,000ï¼‰', price: 5000 },
                { id: 11, name: 'ãã®ä»–ï¼ˆÂ¥10,000ï¼‰', price: 10000 },
                { id: 12, name: 'ãã®ä»–ï¼ˆÂ¥15,000ï¼‰', price: 15000 }
            ]
        };

        let feeStructureData = {
            jackx: [
                { payments: 1, fee: 0 },
                { payments: 3, fee: 0 },
                { payments: 6, fee: 0 },
                { payments: 10, fee: 0 },
                { payments: 12, fee: 1.2 },
                { payments: 15, fee: 3.0 },
                { payments: 18, fee: 4.8 },
                { payments: 20, fee: 6.0 },
                { payments: 24, fee: 8.4 },
                { payments: 30, fee: 12.0 },
                { payments: 36, fee: 15.6 }
            ],
            kl: [
                { payments: 1, fee: 0 },
                { payments: 3, fee: 0 },
                { payments: 6, fee: 0 },
                { payments: 10, fee: 0 },
                { payments: 12, fee: 1.0 },
                { payments: 15, fee: 2.1 },
                { payments: 18, fee: 3.1 },
                { payments: 20, fee: 3.8 },
                { payments: 24, fee: 5.2 },
                { payments: 30, fee: 7.3 },
                { payments: 36, fee: 9.4 }
            ]
        };

        // ãƒ—ãƒªã‚»ãƒƒãƒˆãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–
        function initPresetData() {
            const saved = localStorage.getItem('presetData');
            if (saved) {
                presetData = JSON.parse(saved);
            } else {
                savePresetData();
            }
            const savedFee = localStorage.getItem('feeStructureData');
            if (savedFee) {
                feeStructureData = JSON.parse(savedFee);
            } else {
                saveFeeStructureData();
            }
        }

        function savePresetData() {
            localStorage.setItem('presetData', JSON.stringify(presetData));
        }

        function saveFeeStructureData() {
            localStorage.setItem('feeStructureData', JSON.stringify(feeStructureData));
        }

        let products = [];
        let calculation = null;

        function addProduct() {
            const id = Date.now();
            products.push({ id, category: 'kimono_awase', price: '' });
            renderProducts();
            updateCalculation();
        }

        function selectPreset(id, presetId) {
            const product = products.find(p => p.id === id);
            if (product && presetId) {
                const preset = presetData[product.category].find(p => p.id == presetId);
                if (preset) {
                    product.price = preset.price;
                    product.presetId = preset.id;
                    updateCalculation();
                }
            }
        }

        function addPresetItem(category) {
            const newId = Math.max(...presetData[category].map(p => p.id || 0), 0) + 1;
            presetData[category].push({
                id: newId,
                name: `æ–°è¦ï¼ˆÂ¥0ï¼‰`,
                price: 0
            });
            savePresetData();
            renderPresetList(category);
        }

        function updatePresetItem(category, index, field, value) {
            if (field === 'price') {
                presetData[category][index].price = parseInt(value) || 0;
            } else {
                presetData[category][index].name = value;
            }
            savePresetData();
            renderPresetList(category);
        }

        function deletePresetItem(category, index) {
            if (confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                presetData[category].splice(index, 1);
                savePresetData();
                renderPresetList(category);
            }
        }

        function renderPresetList(category) {
            const container = document.getElementById(category === 'guard' ? 'guardList' : category === 'lining' ? 'liningList' : category === 'tailor' ? 'tailorList' : 'otherList');
            
            container.innerHTML = presetData[category].map((item, index) => `
                <div class="product-item">
                    <div class="form-group">
                        <label>å•†å“å</label>
                        <input type="text" value="${item.name}" onchange="updatePresetItem('${category}', ${index}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label>é‡‘é¡ï¼ˆå††ï¼‰</label>
                        <input type="number" value="${item.price}" placeholder="0" onchange="updatePresetItem('${category}', ${index}, 'price', this.value)" oninput="this.value = formatNumberInput(this.value)">
                    </div>
                    <button class="btn-remove" onclick="deletePresetItem('${category}', ${index})">å‰Šé™¤</button>
                </div>
            `).join('');
        }

        function renderFeeStructureList(cardType) {
            const container = document.getElementById(cardType === 'jackx' ? 'jackxFeeList' : 'klFeeList');
            const data = feeStructureData[cardType];

            container.innerHTML = data.map((item, index) => `
                <div class="product-item">
                    <div class="row">
                        <div class="form-group">
                            <label>æ”¯æ‰•ã„å›æ•°</label>
                            <input type="number" value="${item.payments}" onchange="updateFeeStructure('${cardType}', ${index}, 'payments', this.value)" min="1">
                        </div>
                        <div class="form-group">
                            <label>æ‰‹æ•°æ–™ï¼ˆ%ï¼‰</label>
                            <input type="number" value="${item.fee}" onchange="updateFeeStructure('${cardType}', ${index}, 'fee', this.value)" step="0.1" min="0" max="100">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateFeeStructure(cardType, index, field, value) {
            if (field === 'payments') {
                feeStructureData[cardType][index].payments = parseInt(value) || 0;
            } else {
                feeStructureData[cardType][index].fee = parseFloat(value) || 0;
            }
            saveFeeStructureData();
            updateCalculation();
        }

        function formatNumberInput(value) {
            return value.replace(/\D/g, '');
        }

        function removeProduct(id) {
            products = products.filter(p => p.id !== id);
            renderProducts();
            updateCalculation();
        }

        function renderProducts() {
            const container = document.getElementById('productsList');
            if (products.length === 0) {
                container.innerHTML = '<p style="color: var(--color-text-secondary); font-size: 12px; text-align: center; padding: 12px;">å•†å“ã‚’è¿½åŠ ã—ã¦ãã ã•ã„</p>';
                return;
            }

            container.innerHTML = products.map(product => {
                const isPresetCategory = ['guard', 'lining', 'tailor', 'other'].includes(product.category);
                const presetOptions = isPresetCategory ? presetData[product.category] : [];
                
                return `
                    <div class="product-item">
                        <div class="form-group">
                            <label>ã‚«ãƒ†ã‚´ãƒªãƒ¼</label>
                            <select onchange="updateProduct(${product.id}, 'category', this.value); renderProducts(); updateCalculation()">
                                <option value="kimono_awase" ${product.category === 'kimono_awase' ? 'selected' : ''}>ç€ç‰©(è¢·)</option>
                                <option value="kimono_hitoe" ${product.category === 'kimono_hitoe' ? 'selected' : ''}>ç€ç‰©(å˜è¡£)</option>
                                <option value="homongi_awase" ${product.category === 'homongi_awase' ? 'selected' : ''}>è¨ªå•ç€(è¢·)</option>
                                <option value="homongi_hitoe" ${product.category === 'homongi_hitoe' ? 'selected' : ''}>è¨ªå•ç€(å˜è¡£)</option>
                                <option value="tsukesage_awase" ${product.category === 'tsukesage_awase' ? 'selected' : ''}>ä»˜ä¸‹ã’(è¢·)</option>
                                <option value="tsukesage_hitoe" ${product.category === 'tsukesage_hitoe' ? 'selected' : ''}>ä»˜ä¸‹ã’(å˜è¡£)</option>
                                <option value="tsukesage_summer" ${product.category === 'tsukesage_summer' ? 'selected' : ''}>ä»˜ä¸‹ã’(å¤ç‰©)</option>
                                <option value="nagajuban_awase" ${product.category === 'nagajuban_awase' ? 'selected' : ''}>é•·è¥¦è¢¢(è¢·)</option>
                                <option value="nagajuban_hitoe" ${product.category === 'nagajuban_hitoe' ? 'selected' : ''}>é•·è¥¦è¢¢(å˜è¡£)</option>
                                <option value="coat_awase" ${product.category === 'coat_awase' ? 'selected' : ''}>ã‚³ãƒ¼ãƒˆ(è¢·)</option>
                                <option value="coat_hitoe" ${product.category === 'coat_hitoe' ? 'selected' : ''}>ã‚³ãƒ¼ãƒˆ(å˜è¡£)</option>
                                <option value="obi" ${product.category === 'obi' ? 'selected' : ''}>å¸¯</option>
                                <option value="small" ${product.category === 'small' ? 'selected' : ''}>å°ç‰©</option>
                                <option value="guard" ${product.category === 'guard' ? 'selected' : ''}>ã‚¬ãƒ¼ãƒ‰</option>
                                <option value="lining" ${product.category === 'lining' ? 'selected' : ''}>è£ç‰©</option>
                                <option value="tailor" ${product.category === 'tailor' ? 'selected' : ''}>ä»•ç«‹</option>
                                <option value="other" ${product.category === 'other' ? 'selected' : ''}>ãã®ä»–</option>
                            </select>
                        </div>
                        ${isPresetCategory ? `
                            <div class="form-group">
                                <label>å•†å“ã‚’é¸æŠ</label>
                                <select onchange="selectPreset(${product.id}, this.value); updateCalculation()">
                                    <option value="">-- é¸æŠã—ã¦ãã ã•ã„ --</option>
                                    ${presetOptions.map(item => `
                                        <option value="${item.id}" ${product.presetId === item.id ? 'selected' : ''}>${item.name} - Â¥${item.price.toLocaleString('ja-JP')}</option>
                                    `).join('')}
                                </select>
                            </div>
                        ` : `
                            <div class="form-group">
                                <label>å•†å“å˜ä¾¡ï¼ˆå††ï¼‰</label>
                                <input type="number" value="${product.price}" placeholder="0" onchange="updateProduct(${product.id}, 'price', this.value)" oninput="this.value = formatNumberInput(this.value); updateCalculation()">
                            </div>
                        `}
                        <button class="btn-remove" onclick="removeProduct(${product.id})">å‰Šé™¤</button>
                    </div>
                `;
            }).join('');
        }

        function updateProduct(id, field, value) {
            const product = products.find(p => p.id === id);
            if (product) {
                product[field] = value;
                updateCalculation();
            }
        }

        function getDiscountRate(customerType, category) {
            // ä¿®ç§‘ç”Ÿï¼šå€¤å¼•ããªã—
            if (customerType === 'student') {
                return 0;
            }
            // ã—ã‚…ã†ç¾ä¼šç”Ÿï¼šã€Œå°ç‰©ã€ã€Œä»•ç«‹ã€ä»¥å¤–ã¯5%å‰²å¼•
            if (customerType === 'member') {
                if (category === 'small' || category === 'tailor') return 0;
                return 5;
            }
            // è¬›å¸«ï¼šã€Œå°ç‰©ã€ä»¥å¤–ã¯10%å‰²å¼•
            if (customerType === 'instructor') {
                if (category === 'small') return 0;
                return 10;
            }
            return 0;
        }

        function formatNumber(num) {
            return Math.round(num).toLocaleString('ja-JP');
        }

        function formatNumberWithDecimal(num) {
            return num.toLocaleString('ja-JP', { maximumFractionDigits: 2, minimumFractionDigits: 0 });
        }

        function updateCalculation() {
            if (products.length === 0 || products.some(p => !p.price || isNaN(p.price))) {
                document.getElementById('resultsSection').style.display = 'none';
                return;
            }

            const customerType = document.getElementById('customerType').value;
            const jackxPayments = parseInt(document.getElementById('jackxPayments').value);
            const jackxSkip = parseInt(document.getElementById('jackxSkip').value);
            const klPayments = parseInt(document.getElementById('klPayments').value);
            const klSkip = parseInt(document.getElementById('klSkip').value);

            // å•†å“ã®è¨ˆç®—
            let totalBeforeFee = 0;
            let totalAfterDiscount = 0;
            let productDetails = [];

            products.forEach(product => {
                const price = parseFloat(product.price);
                const discountRate = getDiscountRate(customerType, product.category);
                const discountAmount = price * (discountRate / 100);
                const priceAfterDiscount = price - discountAmount;

                totalBeforeFee += price;
                totalAfterDiscount += priceAfterDiscount;

                productDetails.push({
                    category: product.category,
                    price: price,
                    discountRate: discountRate,
                    discountAmount: discountAmount,
                    priceAfterDiscount: priceAfterDiscount
                });
            });

            // ã‚¸ãƒ£ãƒƒã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰ã®è¨ˆç®—
            const jackxFeeItem = feeStructureData.jackx.find(f => f.payments == jackxPayments);
            const jackxFeeRate = jackxFeeItem ? jackxFeeItem.fee : 0;
            const jackxSkipFee = feeStructure.jackx.skip[jackxSkip];
            const jackxTotalFeeRate = jackxFeeRate + jackxSkipFee;
            const jackxFeeAmount = Math.floor(totalAfterDiscount * (jackxTotalFeeRate / 100));
            const jackxFinal = totalAfterDiscount + jackxFeeAmount;
            const jackxPerMonth = Math.round(jackxFinal / jackxPayments * 100) / 100;

            // KLã®è¨ˆç®—
            const klFeeItem = feeStructureData.kl.find(f => f.payments == klPayments);
            const klFeeRate = klFeeItem ? klFeeItem.fee : 0;
            const klSkipFee = feeStructure.kl.skip[klSkip];
            const klTotalFeeRate = klFeeRate + klSkipFee;
            const klFeeAmount = Math.floor(totalAfterDiscount * (klTotalFeeRate / 100));
            const klFinal = totalAfterDiscount + klFeeAmount;
            const klPerMonth = Math.round(klFinal / klPayments * 100) / 100;

            calculation = {
                customerType,
                productDetails,
                totalBeforeFee,
                jackx: {
                    payments: jackxPayments,
                    skip: jackxSkip,
                    feeRate: jackxFeeRate,
                    skipFee: jackxSkipFee,
                    totalFeeRate: jackxTotalFeeRate,
                    feeAmount: jackxFeeAmount,
                    final: jackxFinal,
                    perMonth: jackxPerMonth
                },
                kl: {
                    payments: klPayments,
                    skip: klSkip,
                    feeRate: klFeeRate,
                    skipFee: klSkipFee,
                    totalFeeRate: klTotalFeeRate,
                    feeAmount: klFeeAmount,
                    final: klFinal,
                    perMonth: klPerMonth
                },
                timestamp: new Date()
            };

            // çµæœã®è¡¨ç¤º
            const discountTotal = calculation.productDetails.reduce((sum, p) => sum + p.discountAmount, 0);

            const summaryHTML = `
                <div style="margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--color-border);">
                    <strong style="color: var(--color-primary); font-size: 13px;">ã‚¸ãƒ£ãƒƒã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰</strong>
                    <div class="summary-row">
                        <span class="summary-label">1. å€¤å¼•ãå‰åˆè¨ˆ</span>
                        <span class="summary-value">Â¥${formatNumber(totalBeforeFee)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">2. å€¤å¼•ãé‡‘é¡</span>
                        <span class="summary-value" style="color: var(--color-warning);">-Â¥${formatNumber(discountTotal)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">3. å€¤å¼•ãå¾Œåˆè¨ˆ</span>
                        <span class="summary-value">Â¥${formatNumber(totalAfterDiscount)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">4. æ‰‹æ•°æ–™</span>
                        <span class="summary-value">Â¥${formatNumber(jackxFeeAmount)} (${jackxTotalFeeRate.toFixed(1)}%)</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">5. æœ€çµ‚åˆè¨ˆ</span>
                        <span class="summary-value" style="color: var(--color-primary); font-weight: 700;">Â¥${formatNumber(jackxFinal)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">6. 1å›ã®æ”¯æ‰•ã„ï¼ˆ${jackxPayments}å›ï¼‰</span>
                        <span class="summary-value" style="color: var(--color-primary); font-weight: 700;">Â¥${formatNumber(jackxPerMonth)}</span>
                    </div>
                </div>
                <div>
                    <strong style="color: var(--color-primary); font-size: 13px;">ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãƒ»KL</strong>
                    <div class="summary-row">
                        <span class="summary-label">1. å€¤å¼•ãå‰åˆè¨ˆ</span>
                        <span class="summary-value">Â¥${formatNumber(totalBeforeFee)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">2. å€¤å¼•ãé‡‘é¡</span>
                        <span class="summary-value" style="color: var(--color-warning);">-Â¥${formatNumber(discountTotal)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">3. å€¤å¼•ãå¾Œåˆè¨ˆ</span>
                        <span class="summary-value">Â¥${formatNumber(totalAfterDiscount)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">4. æ‰‹æ•°æ–™</span>
                        <span class="summary-value">Â¥${formatNumber(klFeeAmount)} (${klTotalFeeRate.toFixed(1)}%)</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">5. æœ€çµ‚åˆè¨ˆ</span>
                        <span class="summary-value" style="color: var(--color-primary); font-weight: 700;">Â¥${formatNumber(klFinal)}</span>
                    </div>
                    <div class="summary-row">
                        <span class="summary-label">6. 1å›ã®æ”¯æ‰•ã„ï¼ˆ${klPayments}å›ï¼‰</span>
                        <span class="summary-value" style="color: var(--color-primary); font-weight: 700;">Â¥${formatNumber(klPerMonth)}</span>
                    </div>
                </div>
            `;

            document.getElementById('summaryDetails').innerHTML = summaryHTML;
            document.getElementById('resultsSection').style.display = 'block';
        }

        function saveToHistory() {
            if (!calculation) return;

            let history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            history.unshift({
                ...calculation,
                id: Date.now()
            });

            // æœ€æ–°100ä»¶ã‚’ä¿æŒ
            history = history.slice(0, 100);

            localStorage.setItem('calculationHistory', JSON.stringify(history));
            loadHistory();

            alert('è¨ˆç®—çµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        }

        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const section = document.getElementById('historySection');

            // æœ€æ–°20ä»¶ã‚’è¡¨ç¤º
            const recentHistory = history.slice(0, 20);

            if (recentHistory.length === 0) {
                section.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“‹</div>
                        <div class="empty-state-text">è¨ˆç®—å±¥æ­´ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>
                    </div>
                `;
                return;
            }

            section.innerHTML = '<h2 style="margin-bottom: 12px;">è¨ˆç®—å±¥æ­´ï¼ˆæœ€æ–°20ä»¶ï¼‰</h2>' + recentHistory.map((calc, index) => {
                const customerLabel = {
                    'student': 'ä¿®ç§‘ç”Ÿ',
                    'member': 'ã—ã‚…ã†ç¾ä¼šç”Ÿ',
                    'instructor': 'è¬›å¸«'
                }[calc.customerType];

                return `
                    <div class="history-item" onclick="showDetail(${history.indexOf(calc)})">
                        <div class="history-time">${new Date(calc.timestamp).toLocaleString('ja-JP')}</div>
                        <div class="history-customer">${customerLabel}</div>
                        <div class="history-total">æœ€çµ‚åˆè¨ˆ: Â¥${formatNumber(calc.jackx.final)} / Â¥${formatNumber(calc.kl.final)}</div>
                        <div class="history-detail">ã‚¸ãƒ£ãƒƒã‚¯ã‚¹ ${calc.jackx.payments}å› / KL ${calc.kl.payments}å›</div>
                        <button class="btn-delete" onclick="deleteHistory(${history.indexOf(calc)}, event)">å‰Šé™¤</button>
                    </div>
                `;
            }).join('');
        }

        function showDetail(index) {
            const history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
            const calc = history[index];

            const customerLabel = {
                'student': 'ä¿®ç§‘ç”Ÿ',
                'member': 'ã—ã‚…ã†ç¾ä¼šç”Ÿ',
                'instructor': 'è¬›å¸«'
            }[calc.customerType];

            const categoryLabel = {
                'kimono_awase': 'ç€ç‰©(è¢·)',
                'kimono_hitoe': 'ç€ç‰©(å˜è¡£)',
                'homongi_awase': 'è¨ªå•ç€(è¢·)',
                'homongi_hitoe': 'è¨ªå•ç€(å˜è¡£)',
                'tsukesage_awase': 'ä»˜ä¸‹ã’(è¢·)',
                'tsukesage_hitoe': 'ä»˜ä¸‹ã’(å˜è¡£)',
                'tsukesage_summer': 'ä»˜ä¸‹ã’(å¤ç‰©)',
                'nagajuban_awase': 'é•·è¥¦è¢¢(è¢·)',
                'nagajuban_hitoe': 'é•·è¥¦è¢¢(å˜è¡£)',
                'coat_awase': 'ã‚³ãƒ¼ãƒˆ(è¢·)',
                'coat_hitoe': 'ã‚³ãƒ¼ãƒˆ(å˜è¡£)',
                'obi': 'å¸¯',
                'small': 'å°ç‰©',
                'guard': 'ã‚¬ãƒ¼ãƒ‰',
                'lining': 'è£ç‰©',
                'tailor': 'ä»•ç«‹',
                'other': 'ãã®ä»–'
            };

            let productHTML = '';
            calc.productDetails.forEach((prod, i) => {
                productHTML += `
                    <div class="detail-item">
                        <span>${i + 1}. ${categoryLabel[prod.category]} - Â¥${formatNumber(prod.price)}</span>
                    </div>
                `;
                if (prod.discountAmount > 0) {
                    productHTML += `
                        <div class="detail-item" style="padding-left: 16px; font-size: 11px; color: var(--color-warning);">
                            <span>å‰²å¼• (-${prod.discountRate}%)</span>
                            <span>-Â¥${formatNumber(prod.discountAmount)}</span>
                        </div>
                    `;
                }
            });

            const content = `
                <h2 style="margin-bottom: 12px; color: var(--color-primary);">è¨ˆç®—è©³ç´°</h2>
                
                <div class="detail-section">
                    <h3>åŸºæœ¬æƒ…å ±</h3>
                    <div class="detail-item">
                        <span>é¡§å®¢ç¨®åˆ¥</span>
                        <span>${customerLabel}</span>
                    </div>
                    <div class="detail-item">
                        <span>è¨ˆç®—æ—¥æ™‚</span>
                        <span>${new Date(calc.timestamp).toLocaleString('ja-JP')}</span>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>å•†å“å†…è¨³</h3>
                    ${productHTML}
                </div>

                <div class="detail-section">
                    <h3>ã‚¸ãƒ£ãƒƒã‚¯ã‚¹ã‚«ãƒ¼ãƒ‰</h3>
                    <div class="detail-item">
                        <span>1. å€¤å¼•ãå‰åˆè¨ˆ</span>
                        <span>Â¥${formatNumber(calc.totalBeforeFee)}</span>
                    </div>
                    <div class="detail-item">
                        <span>2. å€¤å¼•ãé‡‘é¡</span>
                        <span style="color: var(--color-warning);">-Â¥${formatNumber(calc.productDetails.reduce((sum, p) => sum + p.discountAmount, 0))}</span>
                    </div>
                    <div class="detail-item">
                        <span>3. æ‰‹æ•°æ–™ (${calc.jackx.totalFeeRate.toFixed(1)}%)</span>
                        <span>+Â¥${formatNumber(calc.jackx.feeAmount)}</span>
                    </div>
                    <div class="detail-item" style="border-top: 1px solid var(--color-border); padding-top: 6px; margin-top: 6px;">
                        <span style="font-weight: 600;">4. æœ€çµ‚åˆè¨ˆ</span>
                        <span style="font-weight: 600; color: var(--color-primary);">Â¥${formatNumber(calc.jackx.final)}</span>
                    </div>
                    <div class="detail-item">
                        <span>5. æ”¯æ‰•ã„å›æ•°</span>
                        <span>${calc.jackx.payments}å›</span>
                    </div>
                    <div class="detail-item">
                        <span style="font-weight: 600;">6. 1å›ã®æ”¯æ‰•ã„</span>
                        <span style="font-weight: 600;">Â¥${formatNumber(calc.jackx.perMonth)}</span>
                    </div>
                </div>

                <div class="detail-section">
                    <h3>ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ãƒ»KL</h3>
                    <div class="detail-item">
                        <span>1. å€¤å¼•ãå‰åˆè¨ˆ</span>
                        <span>Â¥${formatNumber(calc.totalBeforeFee)}</span>
                    </div>
                    <div class="detail-item">
                        <span>2. å€¤å¼•ãé‡‘é¡</span>
                        <span style="color: var(--color-warning);">-Â¥${formatNumber(calc.productDetails.reduce((sum, p) => sum + p.discountAmount, 0))}</span>
                    </div>
                    <div class="detail-item">
                        <span>3. æ‰‹æ•°æ–™ (${calc.kl.totalFeeRate.toFixed(1)}%)</span>
                        <span>+Â¥${formatNumber(calc.kl.feeAmount)}</span>
                    </div>
                    <div class="detail-item" style="border-top: 1px solid var(--color-border); padding-top: 6px; margin-top: 6px;">
                        <span style="font-weight: 600;">4. æœ€çµ‚åˆè¨ˆ</span>
                        <span style="font-weight: 600; color: var(--color-primary);">Â¥${formatNumber(calc.kl.final)}</span>
                    </div>
                    <div class="detail-item">
                        <span>5. æ”¯æ‰•ã„å›æ•°</span>
                        <span>${calc.kl.payments}å›</span>
                    </div>
                    <div class="detail-item">
                        <span style="font-weight: 600;">6. 1å›ã®æ”¯æ‰•ã„</span>
                        <span style="font-weight: 600;">Â¥${formatNumber(calc.kl.perMonth)}</span>
                    </div>
                </div>
            `;

            document.getElementById('detailContent').innerHTML = content + '<button class="modal-close" onclick="closeModal()">é–‰ã˜ã‚‹</button>';
            document.getElementById('detailModal').classList.add('active');
        }

        function deleteHistory(index, event) {
            event.stopPropagation();
            if (confirm('ã“ã®å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                let history = JSON.parse(localStorage.getItem('calculationHistory') || '[]');
                history.splice(index, 1);
                localStorage.setItem('calculationHistory', JSON.stringify(history));
                loadHistory();
            }
        }

        function closeModal() {
            document.getElementById('detailModal').classList.remove('active');
        }

        function switchTab(tab) {
            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(tab).classList.add('active');

            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'history') {
                loadHistory();
            } else if (tab === 'preset') {
                renderFeeStructureList('jackx');
                renderFeeStructureList('kl');
                renderPresetList('guard');
                renderPresetList('lining');
                renderPresetList('tailor');
                renderPresetList('other');
            }
        }

        // åˆæœŸåŒ–
        initPresetData();
        addProduct();
        loadHistory();

        // PWAå¯¾å¿œï¼šServiceWorkerã®ç™»éŒ²
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('data:application/javascript,self.addEventListener("install",e=>self.skipWaiting());self.addEventListener("activate",e=>e.waitUntil(clients.claim()));').catch(err => console.log('SW registration failed', err));
        }
    </script>
</body>
</html>
